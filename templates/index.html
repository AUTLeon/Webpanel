<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Minecraft Webpanel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        let currentServer = null;

        function showDashboard(serverKey) {
            document.getElementById('home').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            currentServer = serverKey;
            document.getElementById('dashboard-title').innerText = 'Server: ' + serverKey;
            fetchLogs();
        }

        function showHome() {
            document.getElementById('home').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            currentServer = null;
        }

        async function fetchLogs() {
            if (!currentServer) return;
            const logBox = document.getElementById('logs');
            try {
                const response = await fetch(`/${currentServer}/logs`);
                const text = await response.text();
                logBox.innerText = text;
                logBox.scrollTop = logBox.scrollHeight; // autoscroll
            } catch (err) {
                logBox.innerText = 'Fehler beim Laden der Logs.';
            }
            setTimeout(fetchLogs, 2000); // jede 2 Sekunden aktualisieren
        }

        async function serverAction(action) {
            if (!currentServer) return;
            const response = await fetch(`/${currentServer}/${action}`);
            const data = await response.json();
            console.log(data.output || data);
            fetchLogs();
        }

        async function sendCommand() {
            if (!currentServer) return;
            const input = document.getElementById('console-input');
            const cmd = input.value;
            if (!cmd) return;
            await fetch(`/${currentServer}/console`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({command: cmd})
            });
            input.value = '';
            fetchLogs();
        }
    </script>
</head>
<body>
    <h1>Minecraft Webpanel</h1>

    <!-- ===== Home Screen ===== -->
    <div id="home">
        {% for key, server in servers.items() %}
        <button class="server-btn" onclick="showDashboard('{{ key }}')">{{ server.name }}</button>
        {% endfor %}
    </div>

    <!-- ===== Dashboard ===== -->
    <div class="dashboard" id="dashboard">
        <h2 id="dashboard-title"></h2>
        <div class="btn-group">
            <button class="btn" onclick="serverAction('start')">Start</button>
            <button class="btn" onclick="serverAction('stop')">Stop</button>
            <button class="btn" onclick="serverAction('restart')">Restart</button>
            <button class="btn" onclick="serverAction('backup')">Backup</button>
            <button class="btn" onclick="showHome()">Back</button>
        </div>

        <div id="logs"></div>

        <div id="console">
            <input type="text" id="console-input" placeholder="Command...">
            <button onclick="sendCommand()">send</button>
        </div>
    </div>

    <footer>
        Minecraft Webpanel &copy; 2025
    </footer>
</body>
</html>
