<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Minecraft Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="wrapper">
        <div class="container">
            <h1>Minecraft Server Panel</h1>

            <div class="meta">
                Active Screen: <strong id="screen-name">lade...</strong>
            </div>

            <div class="buttons">
            <a href="/start"><button class="start">ðŸš€ Starten</button></a>
            <a href="/stop"><button class="stop">ðŸ›‘ Stoppen</button></a>
            <a href="/backup"><button class="backup">ðŸ’¾ Backup</button></a>
            </div>

            <div class="status">
                Status: <span id="status-text">lade...</span>
            </div>
        </div>
        <div class="container2">
            <div class="logs-controls">
                <button id="refresh-logs">Logs aktualisieren</button>
                <label><input type="checkbox" id="auto-refresh-logs"> Auto-refresh (5s)</label>
                <label>Zeilen: <input id="log-lines" type="number" value="25" min="10" max="5000" style="width:80px"></label>
            </div>

            <pre id="logs" class="logs">lade logs...</pre>
        </div>
    </div>
<script>
async function updateStatus(){
    try{
        const resp = await fetch("/status");
        const j = await resp.json();
        const s = document.getElementById("status-text");
        const sn = document.getElementById("screen-name");
        if(j.running){
            s.innerText = "lÃ¤uft";
            s.style.color = "#4caf50";
        } else {
            s.innerText = "gestoppt";
            s.style.color = "#f44336";
        }
        sn.innerText = j.detected_screen ? j.detected_screen : "keine erkannt";
    } catch(e){
        document.getElementById("status-text").innerText = "Fehler!";
        document.getElementById("status-text").style.color = "#ff9800";
        document.getElementById("screen-name").innerText = "Fehler";
    }
}

async function loadLogs(){
    const lines = document.getElementById("log-lines").value || 200;
    try{
        const resp = await fetch(`/logs?lines=${lines}`);
        if(resp.status === 200){
            const txt = await resp.text();
            document.getElementById("logs").innerText = txt;
        } else {
            const txt = await resp.text();
            document.getElementById("logs").innerText = "Fehler: " + txt;
        }
    } catch(e){
        document.getElementById("logs").innerText = "Fehler beim Laden der Logs";
    }
}

document.getElementById("refresh-logs").addEventListener("click", () => loadLogs());
let autoLogsInterval = null;
document.getElementById("auto-refresh-logs").addEventListener("change", function(){
    if(this.checked){
        loadLogs();
        autoLogsInterval = setInterval(loadLogs, 5000);
    } else {
        if(autoLogsInterval) clearInterval(autoLogsInterval);
    }
});

// Buttons: intercept und Status nach Aktion aktualisieren
document.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', async function(e){
        e.preventDefault();
        try{
            const resp = await fetch(this.href);
            const txt = await resp.text();
            const s = document.getElementById("status-text");
            s.innerText = txt;
            s.style.color = "#f0a500";
            // kleine VerzÃ¶gerung, damit Start/Stop Zeit hat
            setTimeout(updateStatus, 1500);
            setTimeout(loadLogs, 2000);
        }catch(e){
            document.getElementById("status-text").innerText = "Fehler!";
        }
    });
});

// initial
updateStatus();
loadLogs();
setInterval(updateStatus, 5000);
</script>
</body>
</html>
