<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Minecraft Webpanel</title>
<link rel="stylesheet" href="style.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Minecraft Webpanel</h1>

<div id="home">
  <h2>Wähle einen Server</h2>
  <div class="server-card" data-server="server1">Server 1.21.10</div>
  <div class="server-card" data-server="server2">Server 1.20.4</div>
</div>

<div id="server-controls" style="display:none;">
  <h2 id="server-title"></h2>
  <div class="buttons">
    <button id="start-btn">Start</button>
    <button id="stop-btn">Stop</button>
    <button id="restart-btn">Restart</button>
    <button id="backup-btn">Backup</button>
  </div>
  <h3>Status: <span id="status">Lade...</span></h3>
  <div id="log"></div>
  <input type="text" id="cmd" placeholder="Befehl eingeben">
  <button id="send-cmd">Senden</button>
  <div class="back-btn">
    <button id="back-btn">Zurück zur Auswahl</button>
  </div>
</div>

<script>
let currentServer = '';

$('.server-card').click(function() {
  currentServer = $(this).data('server');
  $('#server-title').text($(this).text());
  $('#home').hide();
  $('#server-controls').show();
  updateStatus();
  updateLogs();
});

$('#back-btn').click(function(){
  $('#server-controls').hide();
  $('#home').show();
  currentServer = '';
});

function updateStatus() {
  $.get(`/${currentServer}/status`, data => { $('#status').text(data.running ? "Läuft" : "Gestoppt"); });
}
function start(){ $.get(`/${currentServer}/start`, updateStatus); }
function stop(){ $.get(`/${currentServer}/stop`, updateStatus); }
function restart(){ $.get(`/${currentServer}/restart`, updateStatus); }
function backup(){ $.get(`/${currentServer}/backup`, data => alert(data.output || data.error)); }

function updateLogs(){
  $.get(`/${currentServer}/logs`, data => {
    $('#log').text(data);
    $('#log').scrollTop($('#log')[0].scrollHeight);
  });
}

$('#start-btn').click(start);
$('#stop-btn').click(stop);
$('#restart-btn').click(restart);
$('#backup-btn').click(backup);

$('#send-cmd').click(function(){
  const cmd = $('#cmd').val();
  if(!cmd) return;
  $.ajax({
    url:`/${currentServer}/console`,
    type:'POST',
    contentType:'application/json',
    data: JSON.stringify({command: cmd}),
    success:()=> { $('#cmd').val(''); updateLogs(); }
  });
});

setInterval(()=>{ if(currentServer) { updateStatus(); updateLogs(); } },2000);
</script>
</body>
</html>
